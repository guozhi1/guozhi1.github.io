<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>32位逆向技术 | 果汁天下苏&#39;s Blog</title>
<meta name="keywords" content="逆向, 基础">
<meta name="description" content="前言 知识来源：《加密与解密》 第一章启动函数 Windows程序在按顺序执行时不是直接从WinMain函数开始的,而是执行别的函数进行初始化,之后调用WinMain函数 （选择WinMain,交叉引用就可以找到上一级） 第二章函数 1. 识别函数 编译器都会使用call与ret指令来进行函数的调">
<meta name="author" content="果汁">
<link rel="canonical" href="http://guozhi1.github.io/posts/tech/32%E4%BD%8D%E9%80%86%E5%90%91%E6%8A%80%E6%9C%AF/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://guozhi1.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="http://guozhi1.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="http://guozhi1.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="http://guozhi1.github.io/img/Q.gif">
<link rel="mask-icon" href="http://guozhi1.github.io/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="32位逆向技术" />
<meta property="og:description" content="前言 知识来源：《加密与解密》 第一章启动函数 Windows程序在按顺序执行时不是直接从WinMain函数开始的,而是执行别的函数进行初始化,之后调用WinMain函数 （选择WinMain,交叉引用就可以找到上一级） 第二章函数 1. 识别函数 编译器都会使用call与ret指令来进行函数的调" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://guozhi1.github.io/posts/tech/32%E4%BD%8D%E9%80%86%E5%90%91%E6%8A%80%E6%9C%AF/" />
<meta property="og:image" content="https://cdn.staticaly.com/gh/guozhi1/blogcdn@master/img/%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E5%85%A5%E5%8F%A3.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-15T15:02:44+08:00" />
<meta property="article:modified_time" content="2023-04-15T15:02:44+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://cdn.staticaly.com/gh/guozhi1/blogcdn@master/img/%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E5%85%A5%E5%8F%A3.png" />
<meta name="twitter:title" content="32位逆向技术"/>
<meta name="twitter:description" content="前言 知识来源：《加密与解密》 第一章启动函数 Windows程序在按顺序执行时不是直接从WinMain函数开始的,而是执行别的函数进行初始化,之后调用WinMain函数 （选择WinMain,交叉引用就可以找到上一级） 第二章函数 1. 识别函数 编译器都会使用call与ret指令来进行函数的调"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "📚文章",
          "item": "http://guozhi1.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  3 ,
          "name": "👨🏻‍💻 技术",
          "item": "http://guozhi1.github.io/posts/tech/"
        }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "32位逆向技术",
      "item": "http://guozhi1.github.io/posts/tech/32%E4%BD%8D%E9%80%86%E5%90%91%E6%8A%80%E6%9C%AF/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "32位逆向技术",
  "name": "32位逆向技术",
  "description": "前言 知识来源：《加密与解密》 第一章启动函数 Windows程序在按顺序执行时不是直接从WinMain函数开始的,而是执行别的函数进行初始化,之后调用WinMain函数 （选择WinMain,交叉引用就可以找到上一级） 第二章函数 1. 识别函数 编译器都会使用call与ret指令来进行函数的调",
  "keywords": [
    "逆向", "基础"
  ],
  "articleBody": "前言 知识来源：《加密与解密》\n第一章启动函数 Windows程序在按顺序执行时不是直接从WinMain函数开始的,而是执行别的函数进行初始化,之后调用WinMain函数\n（选择WinMain,交叉引用就可以找到上一级）\n第二章函数 1. 识别函数 编译器都会使用call与ret指令来进行函数的调用与返回。 call可以直接跳到被调用函数的地址段。call与跳转指令有着分别不同的是，call保存返回的地址到栈中，当执行到ret的时候ret就会使用call保存在栈里的地址。 call用于函数的开始，ret用于函数的结束（不是所有ret都代表这函数的结束）。 int Add(int x,int y); main( ) { int a=5,b=6; Add(a,b); return 0; } Add(int x,int y) { return(x+y); } int Add(int x, int y); void main() { 003517A0 push ebp 003517A1 mov ebp,esp 003517A3 sub esp,0D8h 003517A9 push ebx 003517AA push esi 003517AB push edi 003517AC lea edi,[ebp-18h] 003517AF mov ecx,6 003517B4 mov eax,0CCCCCCCCh 003517B9 rep stos dword ptr es:[edi] 003517BB mov ecx,offset _99047FA2_源@cpp (035C000h) 003517C0 call @__CheckForDebuggerJustMyCode@4 (035130Ch) int a = 5, b = 6; 003517C5 mov dword ptr [a],5 003517CC mov dword ptr [b],6 Add(a,b); 003517D3 mov eax,dword ptr [b] 003517D6 push eax 003517D7 mov ecx,dword ptr [a] 003517DA push ecx 003517DB call Add (03511B3h) //函数的开始 003517E0 add esp,8 } int Add(int x, int y) { 00351740 push ebp 00351741 mov ebp,esp 00351743 sub esp,0C0h 00351749 push ebx 0035174A push esi 0035174B push edi 0035174C mov edi,ebp 0035174E xor ecx,ecx 00351750 mov eax,0CCCCCCCCh 00351755 rep stos dword ptr es:[edi] 00351757 mov ecx,offset _99047FA2_源@cpp (035C000h) 0035175C call @__CheckForDebuggerJustMyCode@4 (035130Ch) return (x + y); 00351761 mov eax,dword ptr [x] 00351764 add eax,dword ptr [y] } 00351767 pop edi 00351768 pop esi 00351769 pop ebx 0035176A add esp,0C0h 00351770 cmp ebp,esp 00351772 call __RTC_CheckEsp (0351235h) 00351777 mov esp,ebp 00351779 pop ebp 0035177A ret //函数的结束 2. 函数的参数 函数传参的三种方式，栈方式，寄存器方式，全局变量 利用栈方式\n栈的基础知识\n常用的调用约定 利用寄存器传参 Fastcall特点就快（因为寄存器传参的原因）\n不同编译器的Fastcall也是不一样的 Visual C++,函数参数左边2个不大于4字节（DWORD）参数放在eax，edx寄存器， 寄存器用完用栈，从从右到左压栈，子程序处理堆栈平衡。浮点值，远指针，_int64 总是栈来传递 Borland Delphi/C++ 的 Fastcall 左边3个不大于4字节（DWORD），分别放在eax，edx，ecx寄存器中其余参数按照PASCAL方式压入。 3. 函数的返回值 return返回值 一般情况下函数的返回值会放在eax中，如果处理的大小超过eax寄存器的容量，edx寄存器中。 通过参数按传引方式返回值\n传递两种方式分别是，传值，引用 - 传值，引用\n示例代码 #include void max(int *a, int *b); void main() { int a = 5; int b = 6; max(\u0026a, \u0026b); //获取变量的内存地址 printf(\"a,b中较大的数是：%d\",a); } void max(int *a, int *b) {\t//if 不带{} 就会影响下一行缩进的代码，如果下列多行代码缩进只会影响if下一行的代码，剩下的无条件执行 if (*a \u003c *b) //*a 代表间接变量去到\u0026a的内存地址 *a 就是取到这个内存地址为保存的的值,然后今进行比较 *a = *b; // 把*b的值赋值到*a位置 } 00B818D5 mov ecx,offset _99047FA2_源@cpp (0B8C003h) 00B818DA call @__CheckForDebuggerJustMyCode@4 (0B8131Bh) int a = 5; 00B818DF mov dword ptr [a],5 //a赋值 int b = 6; 00B818E6 mov dword ptr [b],6 //b赋值 max(\u0026a, \u0026b); //获取变量的内存地址 00B818ED lea eax,[b] //第二个参数 lea取的是地址 00B818F0 push eax 00B818F1 lea ecx,[a] //第一个参数 lea取的是地址 00B818F4 push ecx 00B818F5 call max (0B81280h) //调用 max 子程序 00B818FA add esp,8 （_cdecl） max()\n00B81787 mov ecx,offset _99047FA2_源@cpp (0B8C003h) 00B8178C call @__CheckForDebuggerJustMyCode@4 (0B8131Bh) if (*a \u003c *b) 00B81791 mov eax,dword ptr [a] //获取a在内存中的十六进制 00B81794 mov ecx,dword ptr [b] //获取b在内存中的十六进制 00B81797 mov edx,dword ptr [eax] //edx = eax 00B81799 cmp edx,dword ptr [ecx] //判断 *a\u003c*b 是否满足条件 00B8179B jge __$EncStackInitStart+2Bh (0B817A7h) //大于等于跳转 *a = *b; 00B8179D mov eax,dword ptr [a] //a 00B817A0 mov ecx,dword ptr [b] //b 00B817A3 mov edx,dword ptr [ecx] // edx=b 00B817A5 mov dword ptr [eax],edx // a = b 赋值 并且作为返回值 } 00B817A7 pop edi //跳到这什么都不改 00B817A8 pop esi 00B817A9 pop ebx 00B817AA add esp,0C0h 00B817B0 cmp ebp,esp 00B817B2 call __RTC_CheckEsp (0B8123Fh) 00B817B7 mov esp,ebp 00B817B9 pop ebp 00B817BA ret 第三章数据结构 1.局部函数 利用栈存放局部变量\n程序sub esp,8这句话就是为局部变量分配分配内存空间，用[ebp-xxxx]寻址调用这些变量，而参数调用相对于ebp偏移量正的，即[ebp+xxxx]。编译在优化模式下。 当函数退出时，用add esp, 8指令平衡栈，以释放局部变量占用的内存，有的编译器给esp 添加负值进行内存的分配，编译器也有可能会用push reg代替sub esp,4。 局部变量分配与清除栈的方式 形式一 形式二 形式三 add esp,n\n….\nsub esp,n add esp,-n\n….\nsub esp,-n push reg\n…\npop reg 利用寄存器存放局部变量 int add(int x,int y); int main(void) { int a=5,b=6; add(a,b); return 0; } int add(int x,int y) { int z; z=x+y; return(z); } .text:004117B0 push ebp .text:004117B1 mov ebp, esp .text:004117B3 sub esp, 0D8h //局部变量申请的栈内存空间 .text:004117B9 push ebx .text:004117BA push esi .text:004117BB push edi .text:004117BC lea edi, [ebp+var_18] .text:004117BF mov ecx, 6 .text:004117C4 mov eax, 0CCCCCCCCh .text:004117C9 rep stosd .text:004117CB mov ecx, offset unk_41C000 .text:004117D0 call j_@__CheckForDebuggerJustMyCode@4 ; __CheckForDebuggerJustMyCode(x) .text:004117D5 mov [ebp+var_8], 5 //局部变量放入var_8中 .text:004117DC mov [ebp+var_14], 6 //局部变量放入var_14中 .text:004117E3 mov eax, [ebp+var_14] //取出var_14放入eax .text:004117E6 push eax .text:004117E7 mov ecx, [ebp+var_8] //取出var_8放入ecx .text:004117EA push ecx .text:004117EB call sub_4112AD .text:004117F0 add esp, 8 //平栈 _cdecl .text:004117F3 xor eax, eax .text:004117F5 pop edi .text:004117F6 pop esi .text:004117F7 pop ebx .text:004117F8 add esp, 0D8h //回收申请的栈内存空间 .text:004117FE cmp ebp, esp .text:00411800 call j___RTC_CheckEsp .text:00411805 mov esp, ebp .text:00411807 pop ebp .text:00411808 retn .text:00411808 _main_0 endp .text:00411808 利用寄存器存放局部变量 除了esp，ebp栈寄存器，其余6个通用寄存器尽可能的存放变量，这样可以减少代码提高程序的执行效率，逆向分析中局部变量生命周期短，必须及时确定当前寄存器的变量是那个变量 2.全局变量 全局变量通常位于.data段，程序访问全局变量时，一般会用固定的硬编码地址对内存地址进行寻址\n如果某个函数的改变了全局变量的值，就能影响其他函数，可以利用全局变量传递参数或者函数的返回值。 全局变量在程序的执行过程中占用内存单元，不像局部变量那样需要的时候才开辟存储单元。\n源码示例\nint z; int add(int x,int y); int main(void) { int a=5,b=6; z=7; add(a,b); return 0; } int add(int x,int y) { return(x+y+z); } main\npush ebp mov ebp, esp sub esp, 0D8h //局部变量申请空间 ....... mov ecx, 6 mov eax, 0CCCCCCCCh rep stosd mov ecx, offset unk_41C000 call j_@__CheckForDebuggerJustMyCode@4 ; __CheckForDebuggerJustMyCode(x) mov [ebp+var_8], 5 //局部变量 mov [ebp+var_14], 6 //局部变量 mov dword_41A138, 7 //全局变量 mov eax, [ebp+var_14] push eax ...... retn add()\npush ebp mov ebp, esp sub esp, 0C0h ...... mov eax, 0CCCCCCCCh rep stosd mov ecx, offset unk_41C000 call j_@__CheckForDebuggerJustMyCode@4 ; __CheckForDebuggerJustMyCode(x) mov eax, [ebp+arg_0] add eax, [ebp+arg_4] add eax, dword_41A138 //全局变量 pop edi ...... call j___RTC_CheckEsp mov esp, ebp pop ebp retn charGPT回答\n可以通过查看汇编代码中的内存地址来判断变量是局部变量还是全局变量。在汇编中，局部变量通常存储在堆栈中，而全局变量则存储在数据段中。通过查看变量的内存地址，如果它在堆栈范围内，则是局部变量，否则是全局变量。\n3.数组 数组在内存中是连续存放的，在汇编访问状态下访问数组一般是通过基址加变址寻址的方式实现的。\n#include int main(void) { static int a[3]={0x11,0x22,0x33}; int i,s=0,b[3]; for(i=0;i\u003c3;i++) { s=s+a[i]; b[i]=s; } for(i=0;i\u003c3;i++) { printf(\"%d\\n\",b[i]); } return 0; } .text:00401009 mov edi, dword_407030[eax] ; ;dword_407030是数组的空间位置, eax 现在是0 指向第一个元素 .text:0040100F add eax, 4 ; eax = 4 这是偏移下一次的地址指向了dword_407034 .text:00401012 add ecx, edi ; ;ecx = dword_407030 数组列表 .text:00401014 cmp eax, 0Ch ; ;if eax == 12 .text:00401017 mov [esp+eax+14h+var_10], ecx ; [esp+eax+14h+var_10] = dword_407030 .text:0040101B jl short loc_401009 ; 等于12的时候就不跳转了 .text:0040101D lea esi, [esp+14h+var_C] ; 数组列表现在到esi中了 .text:00401021 mov edi, 3 ; edi = 3 覆盖了数组元素 .text:00401026 .text:00401026 loc_401026: ; CODE XREF: _main+3A↓j .text:00401026 mov eax, [esi] ; 第二个循环 .text:00401028 push eax .text:00401029 push offset aD ; \"%d\" .text:0040102E call printf ; 打印一次 .text:00401033 add esp, 8 ; 栈平衡 .text:00401036 add esi, 4 ; 数组指向下一个元素 .text:00401039 dec edi ; edi = 3-1计数器 .text:0040103A jnz short loc_401026 ; 第二个循环 .text:0040103C pop edi .text:0040103D xor eax, eax .text:0040103F pop esi .text:00401040 add esp, 0Ch .text:00401043 retn .text:00401043 _main endp dword_407030\n.data:0040702C align 10h ;[0]第一个元素 .data:00407030 dword_407030 dd 11h ; DATA XREF: _main:loc_401009↑r .data:00407034 db 22h ; \" .data:00407035 db 0 .data:00407036 db 0 .data:00407037 db 0 .data:00407038 db 33h ;最后指向的元素 .data:00407039 db 0 .data:0040703A db 0 .data:0040703B db 0 .data:0040703C aD db '%d' ; DATA XREF: _main+29↑o .data:0040703E db 0Ah .data:0040703F db 0 第四章虚函数 虚函数是在程序运行之前定义的函数，虚函数的地址不能在编译时确定，只能在调用即将进行时确定。所有的虚函数引用通常放在一个专用的数组————虚函数表，数组中的每个元素存放的就是类中的虚函数地址。\n调用虚函数时，程序先从虚函数表指针，得到函数地址，再根据取出的函数地址调用函数 对象实例 –\u003e 函数表 –\u003e 要调用的函数的地址 #include class CSum { public: virtual int Add(int a, int b) { return (a + b); } virtual\tint\tSub(int a, int b ) { return (a - b); } }; void main() { CSum*\tpCSum = new CSum ; pCSum-\u003eAdd(1,2); pCSum-\u003eSub(1,2); } .text:00401000 push esi .text:00401001 push 4 ; Size .text:00401003 call ??2@YAPAXI@Z ; new()函数，这里决定了虚表的位置 .text:00401008 add esp, 4 .text:0040100B test eax, eax .text:0040100D jz short loc_401019 .text:0040100F mov dword ptr [eax], offset off_4050A0 ; 这是指向虚表的的指针，eax的地址存放的内容是004050A0 .text:00401015 mov esi, eax ; esi=eax的内存地址 .text:00401017 jmp short loc_40101B ; eax = esi = eax存放在该地址的内容 = 004050A0，[]取的是内容 .text:00401019 ; --------------------------------------------------------------------------- .text:00401019 .text:00401019 loc_401019: ; CODE XREF: _main+D↑j .text:00401019 xor esi, esi .text:0040101B .text:0040101B loc_40101B: ; CODE XREF: _main+17↑j .text:0040101B mov eax, [esi] ; eax = esi = eax存放在该地址的内容 = 004050A0，[]取的是内容 .text:0040101D push 2 .text:0040101F push 1 .text:00401021 mov ecx, esi ; ecx = esi = eax的内存地址 .text:00401023 call dword ptr [eax] ; 第一次调用函数 .text:00401025 mov edx, [esi] ; edx = 004050A0 .text:00401027 push 2 .text:00401029 push 1 .text:0040102B mov ecx, esi .text:0040102D call dword ptr [edx+4] ; 因为在内存中是连续的，所以第二次调用+4的偏移。004050A4 = 4 + (edx = 004050A0) .text:00401030 pop esi .text:00401031 retn .text:00401031 _main endp 现在可以看看004050A0这位置存放的是什么\n.rdata:004050A0 off_4050A0 dd offset sub_401040 ; DATA XREF: _main+F↑o //add函数 .rdata:004050A4 dd offset sub_401050 //sub函数 004050A0、004050A4就是不同函数的地址\n第五章控制流程语句 1. if判断 2. switch #include int main(void) { int a; scanf(\"%d\",\u0026a); switch(a) { case 1 :printf(\"a=1\"); break; case 2 :printf(\"a=2\"); break; case 10:printf(\"a=10\"); break; default :printf(\"a=default\"); break; } return 0; } .text:0040100A push offset Format ; \"%d\" .text:0040100F call _scanf ; scanf .text:00401014 add esp, 8 ; 堆栈平衡 .text:00401017 mov ecx, [ebp+var_4] .text:0040101A mov [ebp+var_8], ecx ; switch(a) .text:0040101D cmp [ebp+var_8], 1 ; case 1: .text:00401021 jz short loc_401031 ; print .text:00401023 cmp [ebp+var_8], 2 ; case 2: .text:00401027 jz short loc_401040 .text:00401029 cmp [ebp+var_8], 0Ah ; case 10: .text:0040102D jz short loc_40104F .text:0040102F jmp short loc_40105E 优化后的\n.text:00401006 push offset Format ; \"%d\" .text:0040100B call _scanf .text:00401010 mov eax, [esp+0Ch+var_4] .text:00401014 add esp, 8 .text:00401017 dec eax .text:00401018 jz short loc_401055 .text:0040101A dec eax .text:0040101B jz short loc_401044 .text:0040101D sub eax, 8 .text:00401020 jz short loc_401033 .text:00401022 push offset aADefault ; \"a=default\" .text:00401027 call sub_401070 .text:0040102C add esp, 4 .text:0040102F xor eax, eax 最大的区别就是原先使用的时内存寻址现在使用的是寄存器，调用寄存器确实比寻址快，就是寄存器少。\n2.2 switch跳转表 这个switch逆向有点东西，这个因为case多会生成switch跳转表再由跳转表进行跳转\n#include int main(void) { int a; scanf(\"%d\",\u0026a); switch(a) { case 1 :printf(\"a=1\"); break; case 2 :printf(\"a=2\"); break; case 3:printf(\"a=3\"); break; case 4:printf(\"a=4\"); break; case 5:printf(\"a=5\"); break; case 6:printf(\"a=6\"); break; case 7:printf(\"a=7\"); break; default :printf(\"a=default\"); break; } return 0; } 假如我们输入的的是7\n.text:00401000 push ecx .text:00401001 lea eax, [esp+4+var_4] .text:00401005 push eax .text:00401006 push offset Format ; \"%d\" .text:0040100B call _scanf .text:00401010 mov ecx, [esp+0Ch+var_4] ; ecx是存放的是从缓冲区读取的内容 .text:00401014 add esp, 8 .text:00401017 lea eax, [ecx-1] ; switch 7 cases .text:0040101A cmp eax, 6 ; 判断eax是否在六case之内。大于6进行ja跳转就是default分支 .text:0040101D ja short def_40101F ; jumptable 0040101F default case .text:0040101F jmp ds:jpt_40101F[eax*4] ; switch jump 要在4010B0的地址偏移量（eax * 4 =要跳转的分支） 走到00401017就会变成6，然后到0040101A进行比较相等不会触发ja跳转， 到0040101F的时候就是(eax=6)*4 = 24然后转换成16进制得到的偏移量就是18 得到的地址就是0040108C\n.text:0040108C .text:0040108C loc_40108C: ; CODE XREF: _main+1F↑j .text:0040108C ; DATA XREF: .text:jpt_40101F↓o .text:0040108C push offset aA7 ; jumptable 0040101F case 7 这是字符串 .text:00401091 call printf .text:00401096 add esp, 4 .text:00401099 xor eax, eax .text:0040109B pop ecx .text:0040109C retn 转移指令机器码计算（跳过） 条件设置指令 （跳过） 第六章循环语句 for循环\n第七章数学运算符 1. 加法 #include int main(void) { int a, b; printf(\"%d\",a+b+0x78); return 0; } lea 是一条纯计算指令\n.text:00401000 push ecx .text:00401001 mov eax, [esp+4+var_4] ; int a .text:00401005 mov ecx, [esp+4+var_4] ; int b .text:00401009 lea edx, [ecx+eax+78h] ; 计算a+b+0x78,结果放到edx中 .text:0040100D push edx .text:0040100E push offset aD ; \"%d\" .text:00401013 call printf 除法（这个可以看C++反汇编大揭秘书上讲的比较好） 第八章文本字符串 1. 字符串的存储格式 C字符串：也称ASCII字符串 “Z\"表示其以”\\0\"为结束标识符。“\\0”代表ASCII码为0的字符。ASCII为0的字符的时候显示空操作符 DOS字符串： 以$结尾作为终止符，基本已被淘汰 PASCAL字符串：这个字符串没有终止符，而是长度符号字符串的头部定义1个字节，用于指示当前字符串的长度，字符串的长度不能过255字符。 Delphi字符串： 为了解决PASCAL 255长度限制设计的增加了对长度的支持，表示长度扩展到2字节，使字符串最大长度达到65535 四字节的Delphi: 少见，表示长度扩展到4字节字符串长度可以到达4GB 字符寻址指令 mov eax,[00401000] ;直接寻址，把00401000地址的双字节数据放到eax中 mov eax, [ecx] ;间接寻址, 即把ecx中的地址所指的内容放到eax lea eax,[00401000] ;把00401000装到eax中 ",
  "wordCount" : "4488",
  "inLanguage": "en",
  "image":"https://cdn.staticaly.com/gh/guozhi1/blogcdn@master/img/%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E5%85%A5%E5%8F%A3.png","datePublished": "2023-04-15T15:02:44+08:00",
  "dateModified": "2023-04-15T15:02:44+08:00",
  "author":{
    "@type": "Person",
    "name": "果汁"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://guozhi1.github.io/posts/tech/32%E4%BD%8D%E9%80%86%E5%90%91%E6%8A%80%E6%9C%AF/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "果汁天下苏's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://guozhi1.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://guozhi1.github.io" accesskey="h" title="果汁天下苏 (Alt + H)">
            <img src="http://guozhi1.github.io/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">果汁天下苏</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://guozhi1.github.io/search" title="🔍 搜索 (Alt &#43; /)" accesskey=/>
                <span>🔍 搜索</span>
                </a>
            </li>
            <li>
                <a href="http://guozhi1.github.io/" title="🏠 主页">
                <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="http://guozhi1.github.io/posts" title="📚 文章">
                <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="http://guozhi1.github.io/tags" title="🧩 标签">
                <span>🧩 标签</span>
                </a>
            </li>
            <li>
                <a href="http://guozhi1.github.io/archives/" title="⏱️ 时间轴">
                <span>⏱️ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://guozhi1.github.io/about" title="🙋🏻‍♂️ 关于">
                <span>🙋🏻‍♂️ 关于</span>
                </a>
            </li>
            <li>
                <a href="http://guozhi1.github.io/links" title="🤝 友链">
                <span>🤝 友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="http://guozhi1.github.io">🏠 主页</a>&nbsp;»&nbsp;<a href="http://guozhi1.github.io/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://guozhi1.github.io/posts/tech/">👨🏻‍💻 技术</a></div>
            <h1 class="post-title">
                32位逆向技术
            </h1>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-04-15
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>4488字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>9分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>果汁
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="http://guozhi1.github.io/tags/%E9%80%86%E5%90%91/" style="color: var(--secondary)!important;">逆向</a>
                &nbsp;<a href="http://guozhi1.github.io/tags/%E5%9F%BA%E7%A1%80/" style="color: var(--secondary)!important;">基础</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "http://guozhi1.github.io"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://cdn.staticaly.com/gh/guozhi1/blogcdn@master/img/%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E5%85%A5%E5%8F%A3.png" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%89%8d%e8%a8%80" aria-label="前言">前言</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e7%ab%a0%e5%90%af%e5%8a%a8%e5%87%bd%e6%95%b0" aria-label="第一章启动函数">第一章启动函数</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e7%ab%a0%e5%87%bd%e6%95%b0" aria-label="第二章函数">第二章函数</a><ul>
                        <ul>
                        
                <li>
                    <a href="#1-%e8%af%86%e5%88%ab%e5%87%bd%e6%95%b0" aria-label="1. 识别函数">1. 识别函数</a></li>
                <li>
                    <a href="#2-%e5%87%bd%e6%95%b0%e7%9a%84%e5%8f%82%e6%95%b0" aria-label="2. 函数的参数">2. 函数的参数</a></li>
                <li>
                    <a href="#3-%e5%87%bd%e6%95%b0%e7%9a%84%e8%bf%94%e5%9b%9e%e5%80%bc" aria-label="3. 函数的返回值">3. 函数的返回值</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%89%e7%ab%a0%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="第三章数据结构">第三章数据结构</a><ul>
                        <ul>
                        
                <li>
                    <a href="#1%e5%b1%80%e9%83%a8%e5%87%bd%e6%95%b0" aria-label="1.局部函数">1.局部函数</a></li>
                <li>
                    <a href="#2%e5%85%a8%e5%b1%80%e5%8f%98%e9%87%8f" aria-label="2.全局变量">2.全局变量</a></li>
                <li>
                    <a href="#3%e6%95%b0%e7%bb%84" aria-label="3.数组">3.数组</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e5%9b%9b%e7%ab%a0%e8%99%9a%e5%87%bd%e6%95%b0" aria-label="第四章虚函数">第四章虚函数</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%94%e7%ab%a0%e6%8e%a7%e5%88%b6%e6%b5%81%e7%a8%8b%e8%af%ad%e5%8f%a5" aria-label="第五章控制流程语句">第五章控制流程语句</a><ul>
                        <ul>
                        
                <li>
                    <a href="#1-if%e5%88%a4%e6%96%adhttpsnoteyoudaocomsmmqysp84" aria-label="1. if判断">1. <a href="https://note.youdao.com/s/MMQySP84">if判断</a></a></li>
                <li>
                    <a href="#2-switch" aria-label="2. switch">2. switch</a></li>
                <li>
                    <a href="#22-switch%e8%b7%b3%e8%bd%ac%e8%a1%a8" aria-label="2.2 switch跳转表">2.2 switch跳转表</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e5%85%ad%e7%ab%a0%e5%be%aa%e7%8e%af%e8%af%ad%e5%8f%a5" aria-label="第六章循环语句">第六章循环语句</a></li>
                <li>
                    <a href="#%e7%ac%ac%e4%b8%83%e7%ab%a0%e6%95%b0%e5%ad%a6%e8%bf%90%e7%ae%97%e7%ac%a6" aria-label="第七章数学运算符">第七章数学运算符</a><ul>
                        <ul>
                        
                <li>
                    <a href="#1-%e5%8a%a0%e6%b3%95" aria-label="1. 加法">1. 加法</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e5%85%ab%e7%ab%a0%e6%96%87%e6%9c%ac%e5%ad%97%e7%ac%a6%e4%b8%b2" aria-label="第八章文本字符串">第八章文本字符串</a><ul>
                        <ul>
                        
                <li>
                    <a href="#1-%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9a%84%e5%ad%98%e5%82%a8%e6%a0%bc%e5%bc%8f" aria-label="1. 字符串的存储格式">1. 字符串的存储格式</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h1 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h1>
<p>知识来源：《加密与解密》</p>
<h1 id="第一章启动函数">第一章启动函数<a hidden class="anchor" aria-hidden="true" href="#第一章启动函数">#</a></h1>
<p>Windows程序在按顺序执行时不是直接从WinMain函数开始的,而是执行别的函数进行初始化,之后调用WinMain函数<br>
（选择WinMain,交叉引用就可以找到上一级）</p>
<p><img loading="lazy" src="https://cdn.staticaly.com/gh/guozhi1/blogcdn@master/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-04-15%20151627.png" alt=""  />
</p>
<h1 id="第二章函数">第二章函数<a hidden class="anchor" aria-hidden="true" href="#第二章函数">#</a></h1>
<h3 id="1-识别函数">1. 识别函数<a hidden class="anchor" aria-hidden="true" href="#1-识别函数">#</a></h3>
<ul>
<li>编译器都会使用call与ret指令来进行函数的调用与返回。</li>
<li>call可以直接跳到被调用函数的地址段。call与跳转指令有着分别不同的是，call保存返回的地址到栈中，当执行到ret的时候ret就会使用call保存在栈里的地址。</li>
<li>call用于函数的开始，ret用于函数的结束（不是所有ret都代表这函数的结束）。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Add</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span>main( )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	 	<span style="color:#66d9ef">int</span> a<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>,b<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>		Add(a,b);
</span></span><span style="display:flex;"><span>	 	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Add(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>(x<span style="color:#f92672">+</span>y);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">int</span> <span style="color:#66d9ef">Add</span>(<span style="color:#66d9ef">int</span> <span style="color:#66d9ef">x</span>, <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">y</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">void</span> <span style="color:#66d9ef">main</span>()
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">003517</span><span style="color:#a6e22e">A0</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">A1</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">ebp</span>,<span style="color:#66d9ef">esp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">A3</span>  <span style="color:#66d9ef">sub</span>         <span style="color:#66d9ef">esp</span>,<span style="color:#ae81ff">0</span><span style="color:#66d9ef">D8h</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">A9</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">ebx</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">AA</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">AB</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">edi</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">AC</span>  <span style="color:#66d9ef">lea</span>         <span style="color:#66d9ef">edi</span>,[<span style="color:#66d9ef">ebp-18h</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">AF</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">ecx</span>,<span style="color:#ae81ff">6</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">B4</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">eax</span>,<span style="color:#ae81ff">0</span><span style="color:#66d9ef">CCCCCCCCh</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">B9</span>  <span style="color:#66d9ef">rep</span> <span style="color:#66d9ef">stos</span>    <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> <span style="color:#66d9ef">es</span>:[<span style="color:#66d9ef">edi</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">BB</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">ecx</span>,<span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">_99047FA2_</span><span style="color:#960050;background-color:#1e0010">源@</span><span style="color:#66d9ef">cpp</span> (<span style="color:#ae81ff">035</span><span style="color:#66d9ef">C000h</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">C0</span>  <span style="color:#66d9ef">call</span>        <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">__CheckForDebuggerJustMyCode@4</span> (<span style="color:#ae81ff">035130</span><span style="color:#66d9ef">Ch</span>)  
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#66d9ef">a</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">5</span>, <span style="color:#66d9ef">b</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">6</span><span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">003517</span><span style="color:#a6e22e">C5</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">a</span>],<span style="color:#ae81ff">5</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">CC</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">b</span>],<span style="color:#ae81ff">6</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">Add</span>(<span style="color:#66d9ef">a</span>,<span style="color:#66d9ef">b</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">003517</span><span style="color:#a6e22e">D3</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">eax</span>,<span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">b</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">D6</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">D7</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">ecx</span>,<span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">a</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">DA</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">003517</span><span style="color:#66d9ef">DB</span>  <span style="color:#66d9ef">call</span>        <span style="color:#66d9ef">Add</span> (<span style="color:#ae81ff">03511</span><span style="color:#66d9ef">B3h</span>)  <span style="color:#75715e">//函数的开始
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">003517</span><span style="color:#a6e22e">E0</span>  <span style="color:#66d9ef">add</span>         <span style="color:#66d9ef">esp</span>,<span style="color:#ae81ff">8</span>  
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">int</span> <span style="color:#66d9ef">Add</span>(<span style="color:#66d9ef">int</span> <span style="color:#66d9ef">x</span>, <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">y</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">00351740</span>  <span style="color:#a6e22e">push</span>        <span style="color:#66d9ef">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351741</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">ebp</span>,<span style="color:#66d9ef">esp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351743</span>  <span style="color:#66d9ef">sub</span>         <span style="color:#66d9ef">esp</span>,<span style="color:#ae81ff">0</span><span style="color:#66d9ef">C0h</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351749</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">ebx</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0035174</span><span style="color:#66d9ef">A</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0035174</span><span style="color:#66d9ef">B</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">edi</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0035174</span><span style="color:#66d9ef">C</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">edi</span>,<span style="color:#66d9ef">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0035174</span><span style="color:#66d9ef">E</span>  <span style="color:#66d9ef">xor</span>         <span style="color:#66d9ef">ecx</span>,<span style="color:#66d9ef">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351750</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">eax</span>,<span style="color:#ae81ff">0</span><span style="color:#66d9ef">CCCCCCCCh</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351755</span>  <span style="color:#66d9ef">rep</span> <span style="color:#66d9ef">stos</span>    <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> <span style="color:#66d9ef">es</span>:[<span style="color:#66d9ef">edi</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351757</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">ecx</span>,<span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">_99047FA2_</span><span style="color:#960050;background-color:#1e0010">源@</span><span style="color:#66d9ef">cpp</span> (<span style="color:#ae81ff">035</span><span style="color:#66d9ef">C000h</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0035175</span><span style="color:#66d9ef">C</span>  <span style="color:#66d9ef">call</span>        <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">__CheckForDebuggerJustMyCode@4</span> (<span style="color:#ae81ff">035130</span><span style="color:#66d9ef">Ch</span>)  
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">x</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#66d9ef">y</span>)<span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">00351761</span>  <span style="color:#a6e22e">mov</span>         <span style="color:#66d9ef">eax</span>,<span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">x</span>]  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351764</span>  <span style="color:#66d9ef">add</span>         <span style="color:#66d9ef">eax</span>,<span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">y</span>]  
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">00351767</span>  <span style="color:#a6e22e">pop</span>         <span style="color:#66d9ef">edi</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351768</span>  <span style="color:#66d9ef">pop</span>         <span style="color:#66d9ef">esi</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351769</span>  <span style="color:#66d9ef">pop</span>         <span style="color:#66d9ef">ebx</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0035176</span><span style="color:#66d9ef">A</span>  <span style="color:#66d9ef">add</span>         <span style="color:#66d9ef">esp</span>,<span style="color:#ae81ff">0</span><span style="color:#66d9ef">C0h</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351770</span>  <span style="color:#66d9ef">cmp</span>         <span style="color:#66d9ef">ebp</span>,<span style="color:#66d9ef">esp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351772</span>  <span style="color:#66d9ef">call</span>        <span style="color:#66d9ef">__RTC_CheckEsp</span> (<span style="color:#ae81ff">0351235</span><span style="color:#66d9ef">h</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351777</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">esp</span>,<span style="color:#66d9ef">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00351779</span>  <span style="color:#66d9ef">pop</span>         <span style="color:#66d9ef">ebp</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0035177</span><span style="color:#66d9ef">A</span>  <span style="color:#66d9ef">ret</span>         <span style="color:#75715e">//函数的结束
</span></span></span></code></pre></div><h3 id="2-函数的参数">2. 函数的参数<a hidden class="anchor" aria-hidden="true" href="#2-函数的参数">#</a></h3>
<ul>
<li>函数传参的三种方式，栈方式，寄存器方式，全局变量
<ul>
<li>利用栈方式<br>
<a href="https://www.bilibili.com/video/BV1Ve4y167vR/?spm_id_from=333.999.0.0&amp;vd_source=b17d2001fe7c04304da3f95e804746d3">栈的基础知识</a><br>
<a href="https://guozhi1.github.io/posts/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%80/">常用的调用约定</a></li>
<li>利用寄存器传参
Fastcall特点就快（因为寄存器传参的原因）<br>
不同编译器的Fastcall也是不一样的
<ul>
<li>Visual C++,函数参数左边2个不大于4字节（DWORD）参数放在eax，edx寄存器， 寄存器用完用栈，从从右到左压栈，子程序处理堆栈平衡。浮点值，远指针，_int64 总是栈来传递</li>
<li>Borland Delphi/C++ 的 Fastcall 左边3个不大于4字节（DWORD），分别放在eax，edx，ecx寄存器中其余参数按照PASCAL方式压入。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-函数的返回值">3. 函数的返回值<a hidden class="anchor" aria-hidden="true" href="#3-函数的返回值">#</a></h3>
<ul>
<li>return返回值
<ul>
<li>一般情况下函数的返回值会放在eax中，如果处理的大小超过eax寄存器的容量，edx寄存器中。</li>
</ul>
</li>
<li>通过参数按传引方式返回值<br>
传递两种方式分别是，传值，引用
- 传值，引用<br>
示例代码</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">max</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>	max(<span style="color:#f92672">&amp;</span>a, <span style="color:#f92672">&amp;</span>b); <span style="color:#75715e">//获取变量的内存地址 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	printf(<span style="color:#e6db74">&#34;a,b中较大的数是：%d&#34;</span>,a);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">max</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b)
</span></span><span style="display:flex;"><span>{				 <span style="color:#75715e">//if 不带{} 就会影响下一行缩进的代码，如果下列多行代码缩进只会影响if下一行的代码，剩下的无条件执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>a <span style="color:#f92672">&lt;</span> <span style="color:#f92672">*</span>b) <span style="color:#75715e">//*a 代表间接变量去到&amp;a的内存地址 *a 就是取到这个内存地址为保存的的值,然后今进行比较
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">*</span>a <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>b; <span style="color:#75715e">// 把*b的值赋值到*a位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#a6e22e">B818D5</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">ecx</span>,<span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">_99047FA2_</span><span style="color:#960050;background-color:#1e0010">源@</span><span style="color:#66d9ef">cpp</span> (<span style="color:#ae81ff">0</span><span style="color:#66d9ef">B8C003h</span>)  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00</span><span style="color:#66d9ef">B818DA</span>  <span style="color:#66d9ef">call</span>        <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">__CheckForDebuggerJustMyCode@4</span> (<span style="color:#ae81ff">0</span><span style="color:#66d9ef">B8131Bh</span>)  
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> <span style="color:#66d9ef">a</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">5</span><span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#a6e22e">B818DF</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">a</span>],<span style="color:#ae81ff">5</span> <span style="color:#75715e">//a赋值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">int</span> <span style="color:#66d9ef">b</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#ae81ff">6</span><span style="color:#75715e">;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#a6e22e">B818E6</span>  <span style="color:#66d9ef">mov</span>         <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">b</span>],<span style="color:#ae81ff">6</span> <span style="color:#75715e">//b赋值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">max</span>(<span style="color:#960050;background-color:#1e0010">&amp;</span><span style="color:#66d9ef">a</span>, <span style="color:#960050;background-color:#1e0010">&amp;</span><span style="color:#66d9ef">b</span>)<span style="color:#75715e">; //获取变量的内存地址 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#a6e22e">B818ED</span>  <span style="color:#66d9ef">lea</span>         <span style="color:#66d9ef">eax</span>,[<span style="color:#66d9ef">b</span>]   <span style="color:#75715e">//第二个参数 lea取的是地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#a6e22e">B818F0</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">eax</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00</span><span style="color:#66d9ef">B818F1</span>  <span style="color:#66d9ef">lea</span>         <span style="color:#66d9ef">ecx</span>,[<span style="color:#66d9ef">a</span>]   <span style="color:#75715e">//第一个参数 lea取的是地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#a6e22e">B818F4</span>  <span style="color:#66d9ef">push</span>        <span style="color:#66d9ef">ecx</span>  
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">00</span><span style="color:#66d9ef">B818F5</span>  <span style="color:#66d9ef">call</span>        <span style="color:#66d9ef">max</span> (<span style="color:#ae81ff">0</span><span style="color:#66d9ef">B81280h</span>)  <span style="color:#75715e">//调用 max 子程序
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">00</span><span style="color:#a6e22e">B818FA</span>  <span style="color:#66d9ef">add</span>         <span style="color:#66d9ef">esp</span>,<span style="color:#ae81ff">8</span>  <span style="color:#960050;background-color:#1e0010">（</span><span style="color:#66d9ef">_cdecl</span><span style="color:#960050;background-color:#1e0010">）</span>
</span></span></code></pre></div><p>max()</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>00B81787  mov         ecx,offset _99047FA2_源@cpp (0B8C003h)  
</span></span><span style="display:flex;"><span>00B8178C  call        @__CheckForDebuggerJustMyCode@4 (0B8131Bh)  
</span></span><span style="display:flex;"><span>	if (*a &lt; *b) 
</span></span><span style="display:flex;"><span>00B81791  mov         eax,dword ptr [a] //获取a在内存中的十六进制  
</span></span><span style="display:flex;"><span>00B81794  mov         ecx,dword ptr [b] //获取b在内存中的十六进制  
</span></span><span style="display:flex;"><span>00B81797  mov         edx,dword ptr [eax] //edx = eax
</span></span><span style="display:flex;"><span>00B81799  cmp         edx,dword ptr [ecx] //判断 *a&lt;*b 是否满足条件
</span></span><span style="display:flex;"><span>00B8179B  jge         __$EncStackInitStart+2Bh (0B817A7h)  //大于等于跳转
</span></span><span style="display:flex;"><span>		*a = *b; 
</span></span><span style="display:flex;"><span>00B8179D  mov         eax,dword ptr [a]  //a
</span></span><span style="display:flex;"><span>00B817A0  mov         ecx,dword ptr [b]  //b
</span></span><span style="display:flex;"><span>00B817A3  mov         edx,dword ptr [ecx]  // edx=b
</span></span><span style="display:flex;"><span>00B817A5  mov         dword ptr [eax],edx  // a = b 赋值 并且作为返回值
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>00B817A7  pop         edi  //跳到这什么都不改
</span></span><span style="display:flex;"><span>00B817A8  pop         esi  
</span></span><span style="display:flex;"><span>00B817A9  pop         ebx  
</span></span><span style="display:flex;"><span>00B817AA  add         esp,0C0h  
</span></span><span style="display:flex;"><span>00B817B0  cmp         ebp,esp  
</span></span><span style="display:flex;"><span>00B817B2  call        __RTC_CheckEsp (0B8123Fh)  
</span></span><span style="display:flex;"><span>00B817B7  mov         esp,ebp  
</span></span><span style="display:flex;"><span>00B817B9  pop         ebp  
</span></span><span style="display:flex;"><span>00B817BA  ret  
</span></span></code></pre></div><h1 id="第三章数据结构">第三章数据结构<a hidden class="anchor" aria-hidden="true" href="#第三章数据结构">#</a></h1>
<h3 id="1局部函数">1.局部函数<a hidden class="anchor" aria-hidden="true" href="#1局部函数">#</a></h3>
<ul>
<li>利用栈存放局部变量<br>
程序<code>sub esp,8</code>这句话就是为局部变量分配分配内存空间，用<code>[ebp-xxxx]</code>寻址调用这些变量，而参数调用相对于ebp偏移量正的，即<code>[ebp+xxxx]</code>。编译在优化模式下。 当函数退出时，用<code>add esp, 8</code>指令平衡栈，以释放局部变量占用的内存，有的编译器给esp 添加负值进行内存的分配，编译器也有可能会用push reg代替sub esp,4。</li>
<li>局部变量分配与清除栈的方式</li>
</ul>
<table>
<thead>
<tr>
<th>形式一</th>
<th>形式二</th>
<th>形式三</th>
</tr>
</thead>
<tbody>
<tr>
<td>add esp,n<br>&hellip;.<br>sub esp,n</td>
<td>add esp,-n<br>&hellip;.<br>sub esp,-n</td>
<td>push reg<br>&hellip;<br>pop reg</td>
</tr>
</tbody>
</table>
<ul>
<li>利用寄存器存放局部变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">int</span> a<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>,b<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>	 add(a,b);
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">int</span> z;
</span></span><span style="display:flex;"><span>	 z<span style="color:#f92672">=</span>x<span style="color:#f92672">+</span>y;
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">return</span>(z);
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">B0</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">ebp</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">B1</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">ebp</span>, <span style="color:#66d9ef">esp</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">B3</span>                 <span style="color:#66d9ef">sub</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">D8h</span>  <span style="color:#75715e">//局部变量申请的栈内存空间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">B9</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">ebx</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">BA</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">esi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">BB</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">edi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">BC</span>                 <span style="color:#66d9ef">lea</span>     <span style="color:#66d9ef">edi</span>, [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_18</span>]
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">BF</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">C4</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">CCCCCCCCh</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">C9</span>                 <span style="color:#66d9ef">rep</span> <span style="color:#66d9ef">stosd</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">CB</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">unk_41C000</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">D0</span>                 <span style="color:#66d9ef">call</span>    <span style="color:#66d9ef">j_@__CheckForDebuggerJustMyCode@4</span> <span style="color:#75715e">; __CheckForDebuggerJustMyCode(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">D5</span>                 <span style="color:#66d9ef">mov</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_8</span>], <span style="color:#ae81ff">5</span>  <span style="color:#75715e">//局部变量放入var_8中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">DC</span>                 <span style="color:#66d9ef">mov</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_14</span>], <span style="color:#ae81ff">6</span> <span style="color:#75715e">//局部变量放入var_14中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">E3</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_14</span>] <span style="color:#75715e">//取出var_14放入eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">E6</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">E7</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">ecx</span>, [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_8</span>] <span style="color:#75715e">//取出var_8放入ecx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">EA</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">EB</span>                 <span style="color:#66d9ef">call</span>    <span style="color:#66d9ef">sub_4112AD</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">F0</span>                 <span style="color:#66d9ef">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">8</span> <span style="color:#75715e">//平栈 _cdecl
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">F3</span>                 <span style="color:#66d9ef">xor</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">F5</span>                 <span style="color:#66d9ef">pop</span>     <span style="color:#66d9ef">edi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">F6</span>                 <span style="color:#66d9ef">pop</span>     <span style="color:#66d9ef">esi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">F7</span>                 <span style="color:#66d9ef">pop</span>     <span style="color:#66d9ef">ebx</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">F8</span>                 <span style="color:#66d9ef">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">D8h</span> <span style="color:#75715e">//回收申请的栈内存空间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">004117</span><span style="color:#a6e22e">FE</span>                 <span style="color:#66d9ef">cmp</span>     <span style="color:#66d9ef">ebp</span>, <span style="color:#66d9ef">esp</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00411800</span>                 <span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">j___RTC_CheckEsp</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00411805</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#66d9ef">ebp</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00411807</span>                 <span style="color:#a6e22e">pop</span>     <span style="color:#66d9ef">ebp</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00411808</span>                 <span style="color:#a6e22e">retn</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00411808</span> <span style="color:#a6e22e">_main_0</span>         <span style="color:#66d9ef">endp</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00411808</span>
</span></span></code></pre></div><ul>
<li>利用寄存器存放局部变量
除了esp，ebp栈寄存器，其余6个通用寄存器尽可能的存放变量，这样可以减少代码提高程序的执行效率，逆向分析中<code>局部变量生命周期短，必须及时确定当前寄存器的变量是那个变量</code></li>
</ul>
<h3 id="2全局变量">2.全局变量<a hidden class="anchor" aria-hidden="true" href="#2全局变量">#</a></h3>
<p>全局变量通常位于.data段，程序访问全局变量时，一般会用固定的硬编码地址对内存地址进行寻址<br>
如果某个函数的改变了全局变量的值，就能影响其他函数，可以利用全局变量传递参数或者函数的返回值。
全局变量在程序的执行过程中占用内存单元，不像局部变量那样需要的时候才开辟存储单元。<br>
源码示例</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> z;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">int</span> a<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>,b<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>	 z<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span>	 add(a,b);
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> x,<span style="color:#66d9ef">int</span> y)
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">return</span>(x<span style="color:#f92672">+</span>y<span style="color:#f92672">+</span>z);
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><p>main</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">ebp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ebp</span>, <span style="color:#66d9ef">esp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sub</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">D8h</span> <span style="color:#75715e">//局部变量申请空间 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">.......</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">CCCCCCCCh</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rep</span> <span style="color:#a6e22e">stosd</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">unk_41C000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">j_@__CheckForDebuggerJustMyCode@4</span> <span style="color:#75715e">; __CheckForDebuggerJustMyCode(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">mov</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_8</span>], <span style="color:#ae81ff">5</span>  <span style="color:#75715e">//局部变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">mov</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_14</span>], <span style="color:#ae81ff">6</span> <span style="color:#75715e">//局部变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">dword_41A138</span>, <span style="color:#ae81ff">7</span> <span style="color:#75715e">//全局变量 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_14</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">......</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">retn</span>
</span></span></code></pre></div><p>add()</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">ebp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ebp</span>, <span style="color:#66d9ef">esp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sub</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">C0h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">......</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">CCCCCCCCh</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rep</span> <span style="color:#a6e22e">stosd</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">unk_41C000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">j_@__CheckForDebuggerJustMyCode@4</span> <span style="color:#75715e">; __CheckForDebuggerJustMyCode(x)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">arg_0</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">arg_4</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">dword_41A138</span>  <span style="color:#75715e">//全局变量 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">pop</span>     <span style="color:#66d9ef">edi</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">......</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">j___RTC_CheckEsp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#66d9ef">ebp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pop</span>     <span style="color:#66d9ef">ebp</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">retn</span>
</span></span></code></pre></div><p>charGPT回答</p>
<blockquote>
<p>可以通过查看汇编代码中的内存地址来判断变量是局部变量还是全局变量。在汇编中，局部变量通常存储在堆栈中，而全局变量则存储在数据段中。通过查看变量的内存地址，如果它在堆栈范围内，则是局部变量，否则是全局变量。</p>
</blockquote>
<h3 id="3数组">3.数组<a hidden class="anchor" aria-hidden="true" href="#3数组">#</a></h3>
<p>数组在内存中是连续存放的，在汇编访问状态下访问数组一般是通过基址加变址寻址的方式实现的。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> a[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">=</span>{<span style="color:#ae81ff">0x11</span>,<span style="color:#ae81ff">0x22</span>,<span style="color:#ae81ff">0x33</span>};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i,s<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,b[<span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span>(i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span>;i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>	{ 
</span></span><span style="display:flex;"><span>		s<span style="color:#f92672">=</span>s<span style="color:#f92672">+</span>a[i];
</span></span><span style="display:flex;"><span>		b[i]<span style="color:#f92672">=</span>s;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span>(i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span>;i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,b[i]);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401009</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">edi</span>, <span style="color:#66d9ef">dword_407030</span>[<span style="color:#66d9ef">eax</span>] <span style="color:#75715e">; ;dword_407030是数组的空间位置, eax 现在是0 指向第一个元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">add</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">4</span>          <span style="color:#75715e">; eax = 4 这是偏移下一次的地址指向了dword_407034
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401012</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">edi</span>        <span style="color:#75715e">; ;ecx = dword_407030 数组列表
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401014</span>                 <span style="color:#a6e22e">cmp</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">Ch</span>        <span style="color:#75715e">; ;if eax == 12
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401017</span>                 <span style="color:#a6e22e">mov</span>     [<span style="color:#66d9ef">esp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">eax</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">14</span><span style="color:#66d9ef">h</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_10</span>], <span style="color:#66d9ef">ecx</span> <span style="color:#75715e">; [esp+eax+14h+var_10] = dword_407030
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">jl</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401009</span> <span style="color:#75715e">; 等于12的时候就不跳转了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">lea</span>     <span style="color:#66d9ef">esi</span>, [<span style="color:#66d9ef">esp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">14</span><span style="color:#66d9ef">h</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_C</span>] <span style="color:#75715e">; 数组列表现在到esi中了
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401021</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">edi</span>, <span style="color:#ae81ff">3</span>          <span style="color:#75715e">; edi = 3 覆盖了数组元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401026</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401026</span> loc_401026:                             <span style="color:#75715e">; CODE XREF: _main+3A↓j
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401026</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">esi</span>]      <span style="color:#75715e">; 第二个循环
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401028</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401029</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">aD</span>       <span style="color:#75715e">; &#34;%d&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040102</span><span style="color:#a6e22e">E</span>                 <span style="color:#66d9ef">call</span>    <span style="color:#66d9ef">printf</span>          <span style="color:#75715e">; 打印一次
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401033</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">8</span>          <span style="color:#75715e">; 栈平衡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401036</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esi</span>, <span style="color:#ae81ff">4</span>          <span style="color:#75715e">; 数组指向下一个元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401039</span>                 <span style="color:#a6e22e">dec</span>     <span style="color:#66d9ef">edi</span>             <span style="color:#75715e">; edi = 3-1计数器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040103</span><span style="color:#a6e22e">A</span>                 <span style="color:#66d9ef">jnz</span>     <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401026</span> <span style="color:#75715e">; 第二个循环
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040103</span><span style="color:#a6e22e">C</span>                 <span style="color:#66d9ef">pop</span>     <span style="color:#66d9ef">edi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040103</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">xor</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040103</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">pop</span>     <span style="color:#66d9ef">esi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401040</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">0</span><span style="color:#66d9ef">Ch</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401043</span>                 <span style="color:#a6e22e">retn</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401043</span> <span style="color:#a6e22e">_main</span>           <span style="color:#66d9ef">endp</span>
</span></span></code></pre></div><p>dword_407030</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">0040702</span><span style="color:#a6e22e">C</span>                 <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">10</span><span style="color:#66d9ef">h</span> <span style="color:#75715e">;[0]第一个元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.data:<span style="color:#960050;background-color:#1e0010">00407030</span> <span style="color:#a6e22e">dword_407030</span>    <span style="color:#66d9ef">dd</span> <span style="color:#ae81ff">11</span><span style="color:#66d9ef">h</span>                  <span style="color:#75715e">; DATA XREF: _main:loc_401009↑r
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.data:<span style="color:#960050;background-color:#1e0010">00407034</span>                 <span style="color:#a6e22e">db</span>  <span style="color:#ae81ff">22</span><span style="color:#66d9ef">h</span> <span style="color:#75715e">; &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.data:<span style="color:#960050;background-color:#1e0010">00407035</span>                 <span style="color:#a6e22e">db</span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">00407036</span>                 <span style="color:#a6e22e">db</span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">00407037</span>                 <span style="color:#a6e22e">db</span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">00407038</span>                 <span style="color:#a6e22e">db</span>  <span style="color:#ae81ff">33</span><span style="color:#66d9ef">h</span> <span style="color:#75715e">;最后指向的元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.data:<span style="color:#960050;background-color:#1e0010">00407039</span>                 <span style="color:#a6e22e">db</span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">0040703</span><span style="color:#a6e22e">A</span>                 <span style="color:#66d9ef">db</span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">0040703</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">db</span>    <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">0040703</span><span style="color:#a6e22e">C</span> <span style="color:#66d9ef">aD</span>              <span style="color:#66d9ef">db</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>%d<span style="color:#960050;background-color:#1e0010">&#39;</span>                 <span style="color:#75715e">; DATA XREF: _main+29↑o
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.data:<span style="color:#960050;background-color:#1e0010">0040703</span><span style="color:#a6e22e">E</span>                 <span style="color:#66d9ef">db</span>  <span style="color:#ae81ff">0</span><span style="color:#66d9ef">Ah</span>
</span></span><span style="display:flex;"><span>.data:<span style="color:#960050;background-color:#1e0010">0040703</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">db</span>    <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h1 id="第四章虚函数">第四章虚函数<a hidden class="anchor" aria-hidden="true" href="#第四章虚函数">#</a></h1>
<p>虚函数是在程序运行之前定义的函数，虚函数的地址不能在编译时确定，只能在调用即将进行时确定。所有的虚函数引用通常放在一个专用的数组————虚函数表，数组中的每个元素存放的就是类中的虚函数地址。</p>
<ul>
<li>调用虚函数时，程序先从虚函数表指针，得到函数地址，再根据取出的函数地址调用函数
<ul>
<li>对象实例 &ndash;&gt; 函数表 &ndash;&gt; 要调用的函数的地址</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CSum</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">int</span> Add(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b) 
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> (a <span style="color:#f92672">+</span> b);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">virtual</span>	<span style="color:#66d9ef">int</span>	<span style="color:#a6e22e">Sub</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b )
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> (a <span style="color:#f92672">-</span> b);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{   
</span></span><span style="display:flex;"><span>	CSum<span style="color:#f92672">*</span>	pCSum <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CSum ;  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	pCSum<span style="color:#f92672">-&gt;</span>Add(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>	pCSum<span style="color:#f92672">-&gt;</span>Sub(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401000</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">esi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401001</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#ae81ff">4</span>               <span style="color:#75715e">; Size
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401003</span>                 <span style="color:#a6e22e">call</span>    <span style="color:#960050;background-color:#1e0010">??</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#66d9ef">YAPAXI@Z</span>    <span style="color:#75715e">; new()函数，这里决定了虚表的位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401008</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">test</span>    <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">jz</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401019</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">eax</span>], <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">off_4050A0</span> <span style="color:#75715e">; 这是指向虚表的的指针，eax的地址存放的内容是004050A0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401015</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">esi</span>, <span style="color:#66d9ef">eax</span>        <span style="color:#75715e">; esi=eax的内存地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401017</span>                 <span style="color:#a6e22e">jmp</span>     <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_40101B</span> <span style="color:#75715e">; eax = esi = eax存放在该地址的内容 = 004050A0，[]取的是内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401019</span> <span style="color:#75715e">; ---------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401019</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401019</span> loc_401019:                             <span style="color:#75715e">; CODE XREF: _main+D↑j
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401019</span>                 <span style="color:#a6e22e">xor</span>     <span style="color:#66d9ef">esi</span>, <span style="color:#66d9ef">esi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">B</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">B</span> <span style="color:#66d9ef">loc_40101B</span>:                             <span style="color:#75715e">; CODE XREF: _main+17↑j
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">esi</span>]      <span style="color:#75715e">; eax = esi = eax存放在该地址的内容 = 004050A0，[]取的是内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401021</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">esi</span>        <span style="color:#75715e">; ecx = esi = eax的内存地址
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401023</span>                 <span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">eax</span>] <span style="color:#75715e">; 第一次调用函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401025</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">edx</span>, [<span style="color:#66d9ef">esi</span>]      <span style="color:#75715e">; edx = 004050A0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401027</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401029</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040102</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">mov</span>     <span style="color:#66d9ef">ecx</span>, <span style="color:#66d9ef">esi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040102</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">call</span>    <span style="color:#66d9ef">dword</span> <span style="color:#66d9ef">ptr</span> [<span style="color:#66d9ef">edx</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">4</span>] <span style="color:#75715e">; 因为在内存中是连续的，所以第二次调用+4的偏移。004050A4 = 4 + (edx = 004050A0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401030</span>                 <span style="color:#a6e22e">pop</span>     <span style="color:#66d9ef">esi</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401031</span>                 <span style="color:#a6e22e">retn</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401031</span> <span style="color:#a6e22e">_main</span>           <span style="color:#66d9ef">endp</span>
</span></span></code></pre></div><p>现在可以看看004050A0这位置存放的是什么</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.rdata:<span style="color:#960050;background-color:#1e0010">004050</span><span style="color:#a6e22e">A0</span> <span style="color:#66d9ef">off_4050A0</span>      <span style="color:#66d9ef">dd</span> <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">sub_401040</span>    <span style="color:#75715e">; DATA XREF: _main+F↑o //add函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.rdata:<span style="color:#960050;background-color:#1e0010">004050</span><span style="color:#a6e22e">A4</span>                 <span style="color:#66d9ef">dd</span> <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">sub_401050</span> <span style="color:#75715e">//sub函数
</span></span></span></code></pre></div><p>004050A0、004050A4就是不同函数的地址</p>
<h1 id="第五章控制流程语句">第五章控制流程语句<a hidden class="anchor" aria-hidden="true" href="#第五章控制流程语句">#</a></h1>
<h3 id="1-if判断httpsnoteyoudaocomsmmqysp84">1. <a href="https://note.youdao.com/s/MMQySP84">if判断</a><a hidden class="anchor" aria-hidden="true" href="#1-if判断httpsnoteyoudaocomsmmqysp84">#</a></h3>
<h3 id="2-switch">2. switch<a hidden class="anchor" aria-hidden="true" href="#2-switch">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">int</span> a;
</span></span><span style="display:flex;"><span>     scanf(<span style="color:#e6db74">&#34;%d&#34;</span>,<span style="color:#f92672">&amp;</span>a);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">switch</span>(a)
</span></span><span style="display:flex;"><span>	 {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=1&#34;</span>);
</span></span><span style="display:flex;"><span>				    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=2&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=10&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">default</span> <span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=default&#34;</span>);
</span></span><span style="display:flex;"><span>					 <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>	 }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">A</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">Format</span>   <span style="color:#75715e">; &#34;%d&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">call</span>    <span style="color:#66d9ef">_scanf</span>          <span style="color:#75715e">; scanf
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401014</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">8</span>          <span style="color:#75715e">; 堆栈平衡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401017</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ecx</span>, [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_4</span>]
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">A</span>                 <span style="color:#66d9ef">mov</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_8</span>], <span style="color:#66d9ef">ecx</span> <span style="color:#75715e">; switch(a)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">cmp</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_8</span>], <span style="color:#ae81ff">1</span>  <span style="color:#75715e">; case 1:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401021</span>                 <span style="color:#a6e22e">jz</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401031</span> <span style="color:#75715e">; print
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401023</span>                 <span style="color:#a6e22e">cmp</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_8</span>], <span style="color:#ae81ff">2</span>  <span style="color:#75715e">; case 2:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401027</span>                 <span style="color:#a6e22e">jz</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401040</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401029</span>                 <span style="color:#a6e22e">cmp</span>     [<span style="color:#66d9ef">ebp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_8</span>], <span style="color:#ae81ff">0</span><span style="color:#66d9ef">Ah</span> <span style="color:#75715e">; case 10:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040102</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">jz</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_40104F</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040102</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">jmp</span>     <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_40105E</span>
</span></span></code></pre></div><p>优化后的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401006</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">Format</span>   <span style="color:#75715e">; &#34;%d&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">call</span>    <span style="color:#66d9ef">_scanf</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401010</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">esp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">0</span><span style="color:#66d9ef">Ch</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_4</span>]
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401014</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401017</span>                 <span style="color:#a6e22e">dec</span>     <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401018</span>                 <span style="color:#a6e22e">jz</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401055</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">A</span>                 <span style="color:#66d9ef">dec</span>     <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">jz</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401044</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">sub</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401020</span>                 <span style="color:#a6e22e">jz</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">loc_401033</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401022</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">aADefault</span> <span style="color:#75715e">; &#34;a=default&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401027</span>                 <span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">sub_401070</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040102</span><span style="color:#a6e22e">C</span>                 <span style="color:#66d9ef">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040102</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">xor</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span></code></pre></div><p>最大的区别就是原先使用的时内存寻址现在使用的是寄存器，调用寄存器确实比寻址快，就是寄存器少。</p>
<h3 id="22-switch跳转表">2.2 switch跳转表<a hidden class="anchor" aria-hidden="true" href="#22-switch跳转表">#</a></h3>
<p>这个switch逆向有点东西，这个因为case多会生成switch跳转表再由跳转表进行跳转</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span> {
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">int</span> a;
</span></span><span style="display:flex;"><span>     scanf(<span style="color:#e6db74">&#34;%d&#34;</span>,<span style="color:#f92672">&amp;</span>a);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">switch</span>(a)
</span></span><span style="display:flex;"><span>	 {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=1&#34;</span>);
</span></span><span style="display:flex;"><span>				    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=2&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=3&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=4&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=5&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=6&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">case</span> <span style="color:#ae81ff">7</span><span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=7&#34;</span>);
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">default</span> <span style="color:#f92672">:</span>printf(<span style="color:#e6db74">&#34;a=default&#34;</span>);
</span></span><span style="display:flex;"><span>					 <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>	 }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	 <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><p>假如我们输入的的是7</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401000</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401001</span>                 <span style="color:#a6e22e">lea</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">esp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_4</span>]
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401005</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401006</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">Format</span>   <span style="color:#75715e">; &#34;%d&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">B</span>                 <span style="color:#66d9ef">call</span>    <span style="color:#66d9ef">_scanf</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401010</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ecx</span>, [<span style="color:#66d9ef">esp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">0</span><span style="color:#66d9ef">Ch</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_4</span>] <span style="color:#75715e">; ecx是存放的是从缓冲区读取的内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401014</span>                 <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401017</span>                 <span style="color:#a6e22e">lea</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">ecx-1</span>]    <span style="color:#75715e">; switch 7 cases
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">A</span>                 <span style="color:#66d9ef">cmp</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">6</span>          <span style="color:#75715e">; 判断eax是否在六case之内。大于6进行ja跳转就是default分支
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">ja</span>      <span style="color:#66d9ef">short</span> <span style="color:#66d9ef">def_40101F</span> <span style="color:#75715e">; jumptable 0040101F default case
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040101</span><span style="color:#a6e22e">F</span>                 <span style="color:#66d9ef">jmp</span>     <span style="color:#66d9ef">ds</span>:<span style="color:#66d9ef">jpt_40101F</span>[<span style="color:#66d9ef">eax</span>*<span style="color:#ae81ff">4</span>] <span style="color:#75715e">; switch jump 要在4010B0的地址偏移量（eax * 4 =要跳转的分支）
</span></span></span></code></pre></div><p>走到<code>00401017</code>就会变成6，然后到<code>0040101A</code>进行比较相等不会触发<code>ja</code>跳转， 到<code>0040101F</code>的时候就是<code>(eax=6)*4 = 24</code>然后转换成16进制得到的偏移量就是<code>18</code>
<img loading="lazy" src="https://cdn.staticaly.com/gh/guozhi1/blogcdn@master/img/20230427144421.png" alt=""  />

得到的地址就是<code>0040108C</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040108</span><span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040108</span><span style="color:#a6e22e">C</span> <span style="color:#66d9ef">loc_40108C</span>:                             <span style="color:#75715e">; CODE XREF: _main+1F↑j
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040108</span><span style="color:#a6e22e">C</span>                                         <span style="color:#75715e">; DATA XREF: .text:jpt_40101F↓o
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040108</span><span style="color:#a6e22e">C</span> <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">aA7</span>                      <span style="color:#75715e">; jumptable 0040101F case 7 这是字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401091</span> <span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">printf</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401096</span> <span style="color:#a6e22e">add</span>     <span style="color:#66d9ef">esp</span>, <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401099</span> <span style="color:#a6e22e">xor</span>     <span style="color:#66d9ef">eax</span>, <span style="color:#66d9ef">eax</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040109</span><span style="color:#a6e22e">B</span> <span style="color:#66d9ef">pop</span>     <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040109</span><span style="color:#a6e22e">C</span> <span style="color:#66d9ef">retn</span>
</span></span></code></pre></div><ol start="3">
<li>转移指令机器码计算（跳过）</li>
<li>条件设置指令 （跳过）</li>
</ol>
<h1 id="第六章循环语句">第六章循环语句<a hidden class="anchor" aria-hidden="true" href="#第六章循环语句">#</a></h1>
<p><a href="https://note.youdao.com/s/Zg9uBZXo">for循环</a></p>
<h1 id="第七章数学运算符">第七章数学运算符<a hidden class="anchor" aria-hidden="true" href="#第七章数学运算符">#</a></h1>
<h3 id="1-加法">1. 加法<a hidden class="anchor" aria-hidden="true" href="#1-加法">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> a, b;
</span></span><span style="display:flex;"><span>	printf(<span style="color:#e6db74">&#34;%d&#34;</span>,a<span style="color:#f92672">+</span>b<span style="color:#f92672">+</span><span style="color:#ae81ff">0x78</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>lea 是一条纯计算指令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401000</span>                 <span style="color:#a6e22e">push</span>    <span style="color:#66d9ef">ecx</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">00401001</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">esp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_4</span>] <span style="color:#75715e">; int a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401005</span>                 <span style="color:#a6e22e">mov</span>     <span style="color:#66d9ef">ecx</span>, [<span style="color:#66d9ef">esp</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">var_4</span>] <span style="color:#75715e">; int b
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401009</span>                 <span style="color:#a6e22e">lea</span>     <span style="color:#66d9ef">edx</span>, [<span style="color:#66d9ef">ecx</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#66d9ef">eax</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">78</span><span style="color:#66d9ef">h</span>] <span style="color:#75715e">; 计算a+b+0x78,结果放到edx中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">D</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">edx</span>
</span></span><span style="display:flex;"><span>.text:<span style="color:#960050;background-color:#1e0010">0040100</span><span style="color:#a6e22e">E</span>                 <span style="color:#66d9ef">push</span>    <span style="color:#66d9ef">offset</span> <span style="color:#66d9ef">aD</span>       <span style="color:#75715e">; &#34;%d&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.text:<span style="color:#960050;background-color:#1e0010">00401013</span>                 <span style="color:#a6e22e">call</span>    <span style="color:#66d9ef">printf</span>
</span></span></code></pre></div><ol start="2">
<li>除法（这个可以看C++反汇编大揭秘书上讲的比较好）</li>
</ol>
<h1 id="第八章文本字符串">第八章文本字符串<a hidden class="anchor" aria-hidden="true" href="#第八章文本字符串">#</a></h1>
<h3 id="1-字符串的存储格式">1. 字符串的存储格式<a hidden class="anchor" aria-hidden="true" href="#1-字符串的存储格式">#</a></h3>
<ul>
<li>C字符串：也称ASCII字符串 &ldquo;Z&quot;表示其以&rdquo;\0&quot;为结束标识符。“\0”代表ASCII码为0的字符。ASCII为0的字符的时候显示空操作符</li>
<li>DOS字符串： 以$结尾作为终止符，基本已被淘汰</li>
<li>PASCAL字符串：这个字符串没有终止符，而是长度符号字符串的头部定义1个字节，用于指示当前字符串的长度，字符串的长度不能过255字符。</li>
<li>Delphi字符串： 为了解决PASCAL 255长度限制设计的增加了对长度的支持，表示长度扩展到2字节，使字符串最大长度达到65535</li>
<li>四字节的Delphi: 少见，表示长度扩展到4字节字符串长度可以到达4GB</li>
</ul>
<ol start="2">
<li>字符寻址指令</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">eax</span>,[<span style="color:#ae81ff">00401000</span>] <span style="color:#75715e">;直接寻址，把00401000地址的双字节数据放到eax中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">eax</span>, [<span style="color:#66d9ef">ecx</span>] <span style="color:#75715e">;间接寻址, 即把ecx中的地址所指的内容放到eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">lea</span> <span style="color:#66d9ef">eax</span>,[<span style="color:#ae81ff">00401000</span>] <span style="color:#75715e">;把00401000装到eax中
</span></span></span></code></pre></div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="http://guozhi1.github.io/posts/tech/src%E6%8C%96%E6%8E%98-pdf%E5%AF%BC%E5%87%BA%E5%AF%BC%E8%87%B4%E7%9A%84ssrf%E6%BC%8F%E6%B4%9E/">
    <span class="title">« 上一页</span>
    <br>
    <span>Src挖掘 Pdf导出导致的ssrf漏洞</span>
  </a>
  <a class="next" href="http://guozhi1.github.io/posts/tech/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%80/">
    <span class="title">下一页 »</span>
    <br>
    <span>逆向基础-调用约定</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 32位逆向技术 on twitter"
       href="https://twitter.com/intent/tweet/?text=32%e4%bd%8d%e9%80%86%e5%90%91%e6%8a%80%e6%9c%af&amp;url=http%3a%2f%2fguozhi1.github.io%2fposts%2ftech%2f32%25E4%25BD%258D%25E9%2580%2586%25E5%2590%2591%25E6%258A%2580%25E6%259C%25AF%2f&amp;hashtags=%e9%80%86%e5%90%91%2c%e5%9f%ba%e7%a1%80">
    <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 32位逆向技术 on linkedin"
       href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fguozhi1.github.io%2fposts%2ftech%2f32%25E4%25BD%258D%25E9%2580%2586%25E5%2590%2591%25E6%258A%2580%25E6%259C%25AF%2f&amp;title=32%e4%bd%8d%e9%80%86%e5%90%91%e6%8a%80%e6%9c%af&amp;summary=32%e4%bd%8d%e9%80%86%e5%90%91%e6%8a%80%e6%9c%af&amp;source=http%3a%2f%2fguozhi1.github.io%2fposts%2ftech%2f32%25E4%25BD%258D%25E9%2580%2586%25E5%2590%2591%25E6%258A%2580%25E6%259C%25AF%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 32位逆向技术 on reddit"
       href="https://reddit.com/submit?url=http%3a%2f%2fguozhi1.github.io%2fposts%2ftech%2f32%25E4%25BD%258D%25E9%2580%2586%25E5%2590%2591%25E6%258A%2580%25E6%259C%25AF%2f&title=32%e4%bd%8d%e9%80%86%e5%90%91%e6%8a%80%e6%9c%af">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 32位逆向技术 on facebook"
       href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fguozhi1.github.io%2fposts%2ftech%2f32%25E4%25BD%258D%25E9%2580%2586%25E5%2590%2591%25E6%258A%2580%25E6%259C%25AF%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 32位逆向技术 on whatsapp"
       href="https://api.whatsapp.com/send?text=32%e4%bd%8d%e9%80%86%e5%90%91%e6%8a%80%e6%9c%af%20-%20http%3a%2f%2fguozhi1.github.io%2fposts%2ftech%2f32%25E4%25BD%258D%25E9%2580%2586%25E5%2590%2591%25E6%258A%2580%25E6%259C%25AF%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 32位逆向技术 on telegram"
       href="https://telegram.me/share/url?text=32%e4%bd%8d%e9%80%86%e5%90%91%e6%8a%80%e6%9c%af&amp;url=http%3a%2f%2fguozhi1.github.io%2fposts%2ftech%2f32%25E4%25BD%258D%25E9%2580%2586%25E5%2590%2591%25E6%258A%2580%25E6%259C%25AF%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: '👉展开评论';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: '👇关闭评论';
        color: var(--content);
    }
</style>


<div>
    <details class="comments_details">
        <summary style="cursor: pointer; margin: 50px 0 20px 0;width: 130px;">
            <span style="font-size: 20px;color: var(--content);">...</span>
        </summary>
        <div id="tcomment"></div>
    </details>
    <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js">
    </script>
    <script>
        twikoo.init({
            envId:  null ,
        el: "#tcomment",
            lang: 'zh-CN',
            region:  null ,
        path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        })
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        -2023
        <a href="http://guozhi1.github.io" style="color:#939393;">果汁天下苏&#39;s Blog</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;"></a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="" style="float:left;margin: 0px 5px 0px 0px;"/>
            
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"果汁天下苏's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"果汁天下苏's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '📄复制';

        function copyingDone() {
            copybutton.innerText = '👌🏻已复制!';
            setTimeout(() => {
                copybutton.innerText = '📄复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「'+"果汁天下苏's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>

<script>
    $("code[class^=language] ").on("mouseover", function () {
        if (this.clientWidth < this.scrollWidth) {
            $(this).css("width", "135%")
            $(this).css("border-top-right-radius", "var(--radius)")
        }
    }).on("mouseout", function () {
        $(this).css("width", "100%")
        $(this).css("border-top-right-radius", "unset")
    })
</script>
</body>

</html>
